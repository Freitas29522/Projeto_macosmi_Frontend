<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pagina Login</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../css/adminlte.css" />
    <script src="/Projeto/Frontend/js/config.js"></script>

    <style>
      body.login-page {
        background-image: url("../../assets/MCM_Banner_06.webp");
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        min-height: 100vh;
      }

      .language-switcher {
        position: fixed;
        bottom: 15px;
        right: 15px;
        display: flex;
        gap: 10px;
        z-index: 9999;
        background: rgba(255, 255, 255, 0.7);
        padding: 5px 10px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      .language-switcher img {
        cursor: pointer;
        transition: transform 0.2s;
      }

      .language-switcher img:hover {
        transform: scale(1.1);
      }
    </style>
  </head>

  <body class="login-page bg-body-secondary">
    <div class="login-box">
      <div class="card card-outline card-primary">
        <div class="card-header text-center">
          <img
            src="../../assets/MACOSMI_LOGO_25_new.png"
            alt="Logo"
            style="width: auto; height: auto"
          />
        </div>
        <div class="card-body login-card-body">
          <!-- ✅ FORM COM SUBMIT CORRIGIDO -->
          <form onsubmit="event.preventDefault(); login();">
            <div class="input-group mb-3">
              <div class="form-floating flex-grow-1">
                <input
                  type="email"
                  class="form-control"
                  id="loginEmail"
                  placeholder="Email"
                  required
                />
                <label for="loginEmail" data-translate="loginEmail">Email</label>
              </div>
              <div class="input-group-text"><i class="bi bi-envelope"></i></div>
            </div>
            <div class="input-group mb-3">
              <div class="form-floating flex-grow-1">
                <input
                  type="password"
                  class="form-control"
                  id="loginPassword"
                  placeholder="Password"
                  required
                />
                <label for="loginPassword" data-translate="loginPassword">Password</label>
              </div>
              <div class="input-group-text">
                <i class="bi bi-lock-fill"></i>
              </div>
            </div>
            <div class="d-grid gap-2 mb-3">
              <!-- ✅ BOTÃO COM TYPE SUBMIT -->
              <button type="submit" class="btn btn-primary">
                <span data-translate="entrar">Entrar</span>
              </button>
            </div>
          </form>

          <p class="text-center">
            <a
              href="#"
              class="recuperar-password"
              data-translate="recuperarPassword"
              >Recuperar Password!</a
            >
          </p>
        </div>
      </div>
    </div>

    <div class="footer-logo">
      <img src="../../assets/logo_Softideia_softgi.png" alt="Logo" />
    </div>

    <!-- SCRIPTS -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn3.devexpress.com/jslib/23.2.3/js/dx.all.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="../../js/login.js"></script>
    <script src="../../js/traducoes.js"></script>

    <!-- BOTOES DE IDIOMA -->
    <div class="language-switcher">
      <a href="#" onclick="setLanguage('pt')" title="Português">
        <img src="../../assets/bandeiras/pt.svg" alt="Português" width="30" />
      </a>
      <a href="#" onclick="setLanguage('en')" title="English">
        <img src="../../assets/bandeiras/gb-eng.svg" alt="English" width="30" />
      </a>
      <a href="#" onclick="setLanguage('fr')" title="Français">
        <img src="../../assets/bandeiras/fr.svg" alt="Frances" width="30" />
      </a>
    </div>

    <!-- MODAL DE ERRO -->
    <div
      class="modal fade"
      id="loginErrorModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="loginErrorLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content text-center">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title w-100" id="loginErrorLabel">Erro no Login</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Fechar"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Credenciais inválidas. Por favor, verifique o seu email e password.
            </p>
          </div>
          <div class="modal-footer justify-content-center">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- FUNÇÃO LOGIN -->
    <script>    
      async function login() {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        const base = window.APP_CONFIG.API_BASE_URL + window.APP_CONFIG.API_PATH;

        const response = await fetch(`${base}/autenticar`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("token", data.token);
          localStorage.setItem("nome", data.nome);
          localStorage.setItem("email", data.email);
          window.location.href = "../bd/geral/geral.html";
        } else {
          const modal = new bootstrap.Modal(document.getElementById("loginErrorModal"));
          modal.show();
        }
      }
    </script>
  </body>
</html>
