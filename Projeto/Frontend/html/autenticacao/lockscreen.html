<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lockscreen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="title" content="AdminLTE 4 | Lockscreen" />
    <meta name="author" content="ColorlibHQ" />
    <meta
      name="description"
      content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS."
    />
    <meta
      name="keywords"
      content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
      integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../css/adminlte.css" />
  </head>

  <body class="lockscreen bg-body-secondary">
    <!-- VÍDEO DE FUNDO -->
    <video autoplay muted loop id="background-video">
      <source src="../../assets/MACOSMI - SHOE FACTORY.mp4" type="video/mp4" />
      O teu browser não suporta vídeo em HTML5.
    </video>
    <div class="video-overlay"></div>
    <div class="lockscreen-wrapper">
  <div class="card shadow-lg border-0 lock-card">
    <div class="card-body text-center p-4">

      <div class="lockscreen-logo mb-3">
        <img src="../../assets/MACOSMI_LOGO_25_new.png" alt="Logo" style="width:auto; height:auto;" />
      </div>

      <div class="lockscreen-name mb-3" id="utilizadorNome"></div>

      <div class="lockscreen-item mb-3">
        <div class="lockscreen-image">
          <img src="../../assets/Imagem_perfil.png" alt="User Image" />
        </div>

        <div class="lockscreen-credentials">
          <div class="input-group">
            <input type="password" class="form-control shadow-none" id="reauthPassword"
              placeholder="Password" data-translate-placeholder="loginPassword" />
            <button type="button" class="btn shadow-none" onclick="reauthenticate()">
              <i class="bi bi-box-arrow-right text-body-secondary"></i>
            </button>
          </div>
        </div>
      </div>

      <p class="mb-0">
        <a href="#" class="recuperar-password" data-translate="trocarUtilizador">Trocar Utilizador!</a>
      </p>

    </div>
  </div>
</div>

    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
      integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ="
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="../../js/adminlte.js"></script>
    <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->

    <script src="/Projeto/Frontend/js/config.js"></script>

    <script>
      const SELECTOR_SIDEBAR_WRAPPER = ".sidebar-wrapper";
      const Default = {
        scrollbarTheme: "os-theme-light",
        scrollbarAutoHide: "leave",
        scrollbarClickScroll: true,
      };
      document.addEventListener("DOMContentLoaded", function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
        if (
          sidebarWrapper &&
          typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== "undefined"
        ) {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>

    <script src="../../js/traducoes.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const nome = localStorage.getItem("nome");
        if (nome) {
          document.getElementById("utilizadorNome").textContent = nome;
        }

        const input = document.getElementById("reauthPassword");

        // cursor automático na password
        input.focus();

        // Enter para desbloquear
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") reauthenticate();
        });
      });

      async function reauthenticate() {
        const email = localStorage.getItem("email");
        const password = document.getElementById("reauthPassword").value;

        if (!email || !password) {
          alert("Faltam dados para autenticar.");
          return;
        }

        const base =
          window.APP_CONFIG.API_BASE_URL + window.APP_CONFIG.API_PATH;

        const response = await fetch(`${base}/autenticar`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("token", data.token);

          const redirect = sessionStorage.getItem("postLoginRedirect");
          sessionStorage.removeItem("postLoginRedirect");

          window.location.href = redirect || "../bd/geral/geral.html";
        } else {
          alert("Password incorreta!");
        }
      }
    </script>
  </body>
</html>

<style>
  #background-video {
    position: fixed;
    top: 50%;
    left: 50%;
    min-width: 100vw;
    min-height: 100vh;
    transform: translate(-50%, -50%);
    object-fit: cover;
    object-position: center;
    z-index: -2;
    pointer-events: none;
  }


  /* Overlay cinematográfico */
.video-overlay {
  position: fixed;
  inset: 0;
  z-index: -1;
  background:
    radial-gradient(circle at center, rgba(0,0,0,0.05), rgba(0,0,0,0.18)),
    linear-gradient(to bottom, rgba(0,0,0,0.15), rgba(0,0,0,0.28));
  pointer-events: none;
}

</style>
